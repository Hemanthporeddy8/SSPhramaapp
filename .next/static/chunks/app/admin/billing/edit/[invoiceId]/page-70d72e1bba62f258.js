(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6100],{8844:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>P});var a=t(95155),i=t(12115),l=t(35695),n=t(6874),r=t.n(n),d=t(30285),c=t(66695),o=t(62523),m=t(85057),u=t(87481),x=t(85055),h=t(50172),p=t(12543);let j=(0,t(40157).A)("FilePen",[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]]);var f=t(21887),v=t(10518),N=t(77223),g=t(34301),y=t(59119),b=t(14636),w=t(36346),S=t(59434),C=t(47262),A=t(59409);function P(){var e;let s=(0,l.useRouter)(),t=(0,l.useParams)().invoiceId,{toast:n}=(0,u.dj)(),[P,F]=(0,i.useState)(null),[k,q]=(0,i.useState)(!0),[I,J]=(0,i.useState)(!1),[R,L]=(0,i.useState)([]),[D,E]=(0,i.useState)(),[G,T]=(0,i.useState)(!1),[$,M]=(0,i.useState)(""),[_,z]=(0,i.useState)(""),[B,U]=(0,i.useState)(""),[O,V]=(0,i.useState)([]),[W,Z]=(0,i.useState)("Pending"),[H,Q]=(0,i.useState)(null),[Y,K]=(0,i.useState)(""),[X,ee]=(0,i.useState)(0),[es,et]=(0,i.useState)(0),[ea,ei]=(0,i.useState)(0),[el,en]=(0,i.useState)(!1),[er,ed]=(0,i.useState)(9),[ec,eo]=(0,i.useState)(9);(0,i.useEffect)(()=>{t&&(q(!0),Promise.all([(0,x.kc)(t),(0,x.uE)()]).then(e=>{let[t,a]=e;if(t){if(F(t),M(t.invoiceNumber),E(t.patientId),z(t.issueDate.split("T")[0]),U(t.dueDate?t.dueDate.split("T")[0]:""),V(t.items),Z(t.status),t.taxAmount&&t.taxAmount>0){en(!0);let e=t.items.reduce((e,s)=>e+s.total,0),s=e>0?t.taxAmount/e*100:0;ed(s/2),eo(s/2)}}else n({title:"Error",description:"Invoice not found.",variant:"destructive"}),s.push("/admin/billing");L(a),q(!1)}).catch(e=>{console.error("Failed to load data:",e),n({title:"Error",description:"Could not load invoice details.",variant:"destructive"}),q(!1),s.push("/admin/billing")}))},[t,n,s]),(0,i.useEffect)(()=>{ee(O.reduce((e,s)=>e+s.total,0))},[O]),(0,i.useEffect)(()=>{if(el){let e=(er+ec)/100*X;et(e),ei(X+e)}else et(0),ei(X)},[el,X,er,ec]);let em=(e,s,t)=>{let a=[...O],i={...a[e]};if("description"===s)i.description=String(t);else if("quantity"===s||"unitPrice"===s){let e=Number(t)||0;"quantity"===s&&(i.quantity=e),"unitPrice"===s&&(i.unitPrice=e)}i.total=i.quantity*i.unitPrice,a[e]=i,V(a)},eu=e=>{O.length>1?V(O.filter((s,t)=>t!==e)):n({title:"Cannot remove",description:"At least one item is required.",variant:"destructive"})},ex=async e=>{if(e.preventDefault(),!D||O.some(e=>!e.description||e.quantity<=0||e.unitPrice<0))return void n({title:"Missing Information",description:"Please select a patient and ensure all items are filled out.",variant:"destructive"});J(!0);try{await (0,x.Dq)(t,{patientId:D,invoiceNumber:$,issueDate:_,dueDate:B||void 0,items:O,amount:X,taxAmount:es,status:W,currency:"INR"}),n({title:"Invoice Updated Successfully!",description:"".concat($," has been updated.")}),s.push("/admin/billing")}catch(e){console.error("Failed to update invoice:",e),n({title:"Error Updating Invoice",description:"An unexpected error occurred.",variant:"destructive"})}finally{J(!1)}},eh=er/100*X,ep=ec/100*X;return k?(0,a.jsxs)("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:[(0,a.jsx)(h.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading invoice editor..."})]}):P?(0,a.jsxs)("div",{className:"container mx-auto",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(d.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)(r(),{href:"/admin/billing",children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Back to Billing List"]})})}),(0,a.jsxs)(c.Zp,{className:"max-w-4xl mx-auto shadow-xl",children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsxs)(c.ZB,{className:"text-2xl font-bold flex items-center gap-2",children:[(0,a.jsx)(j,{className:"h-7 w-7 text-primary"})," Edit Invoice"]}),(0,a.jsxs)(c.BT,{children:["Modify details for invoice: ",P.invoiceNumber]})]}),(0,a.jsxs)("form",{onSubmit:ex,children:[(0,a.jsxs)(c.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(m.J,{htmlFor:"patient",children:["Patient ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(b.AM,{open:G,onOpenChange:T,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",role:"combobox","aria-expanded":G,className:"w-full justify-between",children:[D?null==(e=R.find(e=>e.id===D))?void 0:e.name:"Select patient...",(0,a.jsx)(f.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(b.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsxs)(w.uB,{children:[(0,a.jsx)(w.G7,{placeholder:"Search patient..."}),(0,a.jsxs)(w.oI,{children:[(0,a.jsx)(w.xL,{children:"No patient found."}),(0,a.jsx)(w.L$,{children:R.map(e=>(0,a.jsxs)(w.h_,{value:e.name,onSelect:()=>{E(e.id),T(!1)},children:[(0,a.jsx)(v.A,{className:(0,S.cn)("mr-2 h-4 w-4",D===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"invoiceNumber",children:"Invoice Number"}),(0,a.jsx)(o.p,{id:"invoiceNumber",value:$,onChange:e=>M(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"issueDate",children:"Issue Date"}),(0,a.jsx)(o.p,{id:"issueDate",type:"date",value:_,onChange:e=>z(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsx)(o.p,{id:"dueDate",type:"date",value:B,onChange:e=>U(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)(m.J,{className:"text-lg font-medium",children:"Invoice Items"}),O.map((e,s)=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsxs)(b.AM,{open:H===s,onOpenChange:e=>Q(e?s:null),children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",role:"combobox",className:"col-span-6 justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:e.description||"Select a test..."}),(0,a.jsx)(f.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(b.hl,{className:"p-0 w-[--radix-popover-trigger-width]",children:(0,a.jsxs)(w.uB,{filter:(e,s)=>{let t=x.SA.find(s=>s.name===e);return+(null!=t&&!!t.name.toLowerCase().includes(s.toLowerCase()))},children:[(0,a.jsx)(w.G7,{placeholder:"Search test or add custom...",value:Y,onValueChange:K}),(0,a.jsxs)(w.oI,{children:[(0,a.jsx)(w.xL,{children:Y.trim()?'No test found for "'.concat(Y,'".'):"No test found."}),(0,a.jsx)(w.L$,{children:x.SA.map(t=>(0,a.jsxs)(w.h_,{value:t.name,onSelect:e=>{em(s,"description",e),K(""),Q(null)},children:[(0,a.jsx)(v.A,{className:(0,S.cn)("mr-2 h-4 w-4",e.description===t.name?"opacity-100":"opacity-0")}),t.name]},t.id))})]}),Y&&!x.SA.some(e=>e.name.toLowerCase()===Y.toLowerCase())&&(0,a.jsx)("div",{className:"p-2 border-t mt-1",children:(0,a.jsxs)(d.$,{variant:"outline",className:"w-full h-9 text-sm",onClick:()=>{em(s,"description",Y.trim()),Q(null),K("")},children:['Add custom item: "',Y.trim(),'"']})})]})})]}),(0,a.jsx)(o.p,{type:"number",placeholder:"Qty",className:"col-span-2",value:e.quantity,onChange:e=>em(s,"quantity",e.target.value),min:"1"}),(0,a.jsx)(o.p,{type:"number",placeholder:"Unit Price (₹)",className:"col-span-2",value:e.unitPrice,onChange:e=>em(s,"unitPrice",e.target.value),min:"0",step:"0.01"}),(0,a.jsxs)("div",{className:"col-span-1 text-right font-medium",children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>eu(s),className:"col-span-1 text-destructive hover:text-destructive",children:(0,a.jsx)(N.A,{className:"h-4 w-4"})})]},s)),(0,a.jsxs)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{V([...O,{description:"",quantity:1,unitPrice:0,total:0}])},className:"mt-2",children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Add Item"]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 pt-4 border-t",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(m.J,{className:"text-lg font-medium",children:"Billing Summary"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(m.J,{children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹",X.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(C.S,{id:"applyGst",checked:el,onCheckedChange:e=>en(e)}),(0,a.jsx)("label",{htmlFor:"applyGst",className:"text-sm font-medium",children:"Apply GST"})]}),el&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 items-center pl-6",children:[(0,a.jsx)(m.J,{htmlFor:"cgstRate",children:"CGST Rate (%)"}),(0,a.jsx)(o.p,{id:"cgstRate",type:"number",className:"h-8",value:er,onChange:e=>ed(Number(e.target.value)||0)}),(0,a.jsx)(m.J,{htmlFor:"sgstRate",children:"SGST Rate (%)"}),(0,a.jsx)(o.p,{id:"sgstRate",type:"number",className:"h-8",value:ec,onChange:e=>eo(Number(e.target.value)||0)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(m.J,{className:"text-muted-foreground",children:"CGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",eh.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(m.J,{className:"text-muted-foreground",children:"SGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",ep.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg font-bold border-t pt-2 mt-2",children:[(0,a.jsx)(m.J,{children:"Grand Total"}),(0,a.jsxs)("span",{children:["₹",ea.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"status",className:"text-lg font-medium",children:"Payment Status"}),(0,a.jsxs)(A.l6,{value:W,onValueChange:e=>Z(e),children:[(0,a.jsx)(A.bq,{id:"status",children:(0,a.jsx)(A.yv,{placeholder:"Select payment status"})}),(0,a.jsxs)(A.gC,{children:[(0,a.jsx)(A.eb,{value:"Pending",children:"Pending"}),(0,a.jsx)(A.eb,{value:"Paid",children:"Paid"}),(0,a.jsx)(A.eb,{value:"Failed",children:"Failed"})]})]})]})]})]}),(0,a.jsxs)(c.wL,{className:"pt-6 flex justify-between",children:[(0,a.jsx)(d.$,{type:"button",variant:"outline",onClick:()=>s.push("/admin/billing"),disabled:I,children:"Cancel"}),(0,a.jsxs)(d.$,{type:"submit",size:"lg",className:"w-full md:w-auto",disabled:I,children:[I?(0,a.jsx)(h.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,a.jsx)(y.A,{className:"mr-2 h-5 w-5"}),"Save Changes"]})]})]})]})]}):null}},17737:(e,s,t)=>{Promise.resolve().then(t.bind(t,8844))},59409:(e,s,t)=>{"use strict";t.d(s,{bq:()=>u,eb:()=>j,gC:()=>p,l6:()=>o,yv:()=>m});var a=t(95155),i=t(12115),l=t(31992),n=t(79556),r=t(77381),d=t(10518),c=t(59434);let o=l.bL;l.YJ;let m=l.WT,u=i.forwardRef((e,s)=>{let{className:t,children:i,...r}=e;return(0,a.jsxs)(l.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...r,children:[i,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let x=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(l.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...i,children:(0,a.jsx)(r.A,{className:"h-4 w-4"})})});x.displayName=l.PP.displayName;let h=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(l.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...i,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let p=i.forwardRef((e,s)=>{let{className:t,children:i,position:n="popper",...r}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[(0,a.jsx)(x,{}),(0,a.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:i}),(0,a.jsx)(h,{})]})})});p.displayName=l.UC.displayName,i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(l.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...i})}).displayName=l.JU.displayName;let j=i.forwardRef((e,s)=>{let{className:t,children:i,...n}=e;return(0,a.jsxs)(l.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:i})]})});j.displayName=l.q7.displayName,i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(l.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...i})}).displayName=l.wv.displayName}},e=>{var s=s=>e(e.s=s);e.O(0,[5769,6874,5676,5688,4443,579,8587,3305,5370,8441,1684,7358],()=>s(17737)),_N_E=e.O()}]);