(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1087],{6421:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var a=s(95155),i=s(12115),n=s(35695),l=s(6874),r=s.n(l),c=s(30285),d=s(66695),o=s(62523),u=s(85057),m=s(87481),h=s(85055),x=s(12543),p=s(68603),j=s(21887),v=s(10518),N=s(77223),f=s(34301),g=s(50172),y=s(59119),b=s(14636),w=s(36346),S=s(59434),C=s(47262);function A(){var e;let t=(0,n.useRouter)(),{toast:s}=(0,m.dj)(),[l,A]=(0,i.useState)(!1),[k,F]=(0,i.useState)(!0),[I,P]=(0,i.useState)([]),[q,D]=(0,i.useState)(),[J,L]=(0,i.useState)(!1),[G,M]=(0,i.useState)("INV-".concat(new Date().getFullYear(),"-").concat(String(Date.now()).slice(-4))),[R,$]=(0,i.useState)(new Date().toISOString().split("T")[0]),[E,T]=(0,i.useState)(""),[_,B]=(0,i.useState)([{description:"",quantity:1,unitPrice:0,total:0}]),[O,z]=(0,i.useState)(null),[Z,V]=(0,i.useState)(""),[W,H]=(0,i.useState)(0),[Q,U]=(0,i.useState)(0),[Y,K]=(0,i.useState)(0),[X,ee]=(0,i.useState)(!1),[et,es]=(0,i.useState)(9),[ea,ei]=(0,i.useState)(9);(0,i.useEffect)(()=>{(0,h.uE)().then(P).finally(()=>F(!1))},[]),(0,i.useEffect)(()=>{H(_.reduce((e,t)=>e+t.total,0))},[_]),(0,i.useEffect)(()=>{if(X){let e=(et+ea)/100*W;U(e),K(W+e)}else U(0),K(W)},[X,W,et,ea]);let en=(e,t,s)=>{let a=[..._],i={...a[e]};if("description"===t)i.description=String(s);else if("quantity"===t||"unitPrice"===t){let e=Number(s)||0;"quantity"===t&&(i.quantity=e),"unitPrice"===t&&(i.unitPrice=e)}i.total=i.quantity*i.unitPrice,a[e]=i,B(a)},el=e=>{_.length>1?B(_.filter((t,s)=>s!==e)):s({title:"Cannot remove",description:"At least one item is required in the invoice.",variant:"destructive"})},er=async e=>{if(e.preventDefault(),!q||_.some(e=>!e.description||e.quantity<=0||e.unitPrice<0))return void s({title:"Missing Information",description:"Please select a patient and ensure all invoice items are filled out correctly (description, quantity > 0, price >= 0).",variant:"destructive"});A(!0);try{await (0,h.Jx)({patientId:q,appointmentId:"manual-creation",invoiceNumber:G,issueDate:R,dueDate:E||void 0,items:_,amount:W,taxAmount:Q,status:"Pending",currency:"INR"}),s({title:"Invoice Created Successfully!",description:"".concat(G," has been created.")}),t.push("/admin/billing")}catch(e){console.error("Failed to create invoice:",e),s({title:"Error Creating Invoice",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{A(!1)}},ec=et/100*W,ed=ea/100*W;return(0,a.jsxs)("div",{className:"container mx-auto",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(c.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)(r(),{href:"/admin/billing",children:[(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Back to Billing List"]})})}),(0,a.jsxs)(d.Zp,{className:"max-w-4xl mx-auto shadow-xl",children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsxs)(d.ZB,{className:"text-2xl font-bold flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-7 w-7 text-primary"})," Create New Invoice"]}),(0,a.jsx)(d.BT,{children:"Fill in the details to generate a new invoice."})]}),(0,a.jsxs)("form",{onSubmit:er,children:[(0,a.jsxs)(d.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(u.J,{htmlFor:"patient",children:["Patient ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(b.AM,{open:J,onOpenChange:L,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",role:"combobox","aria-expanded":J,className:"w-full justify-between",disabled:k,children:[k?"Loading patients...":q?null==(e=I.find(e=>e.id===q))?void 0:e.name:"Select patient...",(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(b.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsxs)(w.uB,{children:[(0,a.jsx)(w.G7,{placeholder:"Search patient..."}),(0,a.jsxs)(w.oI,{children:[(0,a.jsx)(w.xL,{children:"No patient found."}),(0,a.jsx)(w.L$,{children:I.map(e=>(0,a.jsxs)(w.h_,{value:e.name,onSelect:()=>{D(e.id),L(!1)},children:[(0,a.jsx)(v.A,{className:(0,S.cn)("mr-2 h-4 w-4",q===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"invoiceNumber",children:"Invoice Number"}),(0,a.jsx)(o.p,{id:"invoiceNumber",value:G,onChange:e=>M(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"issueDate",children:"Issue Date"}),(0,a.jsx)(o.p,{id:"issueDate",type:"date",value:R,onChange:e=>$(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsx)(o.p,{id:"dueDate",type:"date",value:E,onChange:e=>T(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)(u.J,{className:"text-lg font-medium",children:"Invoice Items"}),_.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsxs)(b.AM,{open:O===t,onOpenChange:e=>z(e?t:null),children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",role:"combobox",className:"col-span-6 justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:e.description||"Select a test..."}),(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(b.hl,{className:"p-0 w-[--radix-popover-trigger-width]",children:(0,a.jsxs)(w.uB,{filter:(e,t)=>{let s=h.SA.find(t=>t.name===e);return+(null!=s&&!!s.name.toLowerCase().includes(t.toLowerCase()))},children:[(0,a.jsx)(w.G7,{placeholder:"Search test or add custom...",value:Z,onValueChange:V}),(0,a.jsxs)(w.oI,{children:[(0,a.jsx)(w.xL,{children:Z.trim()?'No test found for "'.concat(Z,'".'):"No test found."}),(0,a.jsx)(w.L$,{children:h.SA.map(s=>(0,a.jsxs)(w.h_,{value:s.name,onSelect:e=>{en(t,"description",e),V(""),z(null)},children:[(0,a.jsx)(v.A,{className:(0,S.cn)("mr-2 h-4 w-4",e.description===s.name?"opacity-100":"opacity-0")}),s.name]},s.id))})]}),Z&&!h.SA.some(e=>e.name.toLowerCase()===Z.toLowerCase())&&(0,a.jsx)("div",{className:"p-2 border-t mt-1",children:(0,a.jsxs)(c.$,{variant:"outline",className:"w-full h-9 text-sm",onClick:()=>{en(t,"description",Z.trim()),z(null),V("")},children:['Add custom item: "',Z.trim(),'"']})})]})})]}),(0,a.jsx)(o.p,{type:"number",placeholder:"Qty",className:"col-span-2",value:e.quantity,onChange:e=>en(t,"quantity",e.target.value),min:"1"}),(0,a.jsx)(o.p,{type:"number",placeholder:"Unit Price (₹)",className:"col-span-2",value:e.unitPrice,onChange:e=>en(t,"unitPrice",e.target.value),min:"0",step:"0.01"}),(0,a.jsxs)("div",{className:"col-span-1 text-right font-medium",children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>el(t),className:"col-span-1 text-destructive hover:text-destructive",children:(0,a.jsx)(N.A,{className:"h-4 w-4"})})]},t)),(0,a.jsxs)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{B([..._,{description:"",quantity:1,unitPrice:0,total:0}])},className:"mt-2",children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Add Item"]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4 border-t",children:(0,a.jsxs)("div",{className:"w-full max-w-sm space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(u.J,{children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹",W.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(C.S,{id:"applyGst",checked:X,onCheckedChange:e=>ee(e)}),(0,a.jsx)("label",{htmlFor:"applyGst",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Apply GST"})]}),X&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 items-center pl-6",children:[(0,a.jsx)(u.J,{htmlFor:"cgstRate",children:"CGST Rate (%)"}),(0,a.jsx)(o.p,{id:"cgstRate",type:"number",className:"h-8",value:et,onChange:e=>es(Number(e.target.value)||0),min:"0"}),(0,a.jsx)(u.J,{htmlFor:"sgstRate",children:"SGST Rate (%)"}),(0,a.jsx)(o.p,{id:"sgstRate",type:"number",className:"h-8",value:ea,onChange:e=>ei(Number(e.target.value)||0),min:"0"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(u.J,{className:"text-muted-foreground",children:"CGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",ec.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(u.J,{className:"text-muted-foreground",children:"SGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",ed.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg font-bold border-t pt-2 mt-2",children:[(0,a.jsx)(u.J,{children:"Grand Total"}),(0,a.jsxs)("span",{children:["₹",Y.toFixed(2)]})]})]})})]}),(0,a.jsx)(d.wL,{className:"pt-6",children:(0,a.jsxs)(c.$,{type:"submit",size:"lg",className:"w-full md:w-auto ml-auto",disabled:l||k,children:[l?(0,a.jsx)(g.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,a.jsx)(y.A,{className:"mr-2 h-5 w-5"}),"Save Invoice"]})})]})]})]})}},10518:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},40968:(e,t,s)=>{"use strict";s.d(t,{b:()=>r});var a=s(12115),i=s(63655),n=s(95155),l=a.forwardRef((e,t)=>(0,n.jsx)(i.sG.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var r=l},45503:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var a=s(12115);function i(e){let t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},63237:(e,t,s)=>{Promise.resolve().then(s.bind(s,6421))},68603:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]])}},e=>{var t=t=>e(e.s=t);e.O(0,[5769,6874,5676,5688,4443,8587,3305,5370,8441,1684,7358],()=>t(63237)),_N_E=e.O()}]);