(()=>{var e={};e.id=1087,e.ids=[1087],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5659:(e,t,s)=>{Promise.resolve().then(s.bind(s,97927))},8633:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\git projects\\\\SSPharmaapp\\\\SSPhramaapp\\\\src\\\\app\\\\admin\\\\billing\\\\new\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\billing\\new\\page.tsx","default")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},40003:(e,t,s)=>{Promise.resolve().then(s.bind(s,8633))},49803:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(82614).A)("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]])},52740:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>o,routeModule:()=>p,tree:()=>d});var a=s(65239),i=s(48088),r=s(88170),n=s.n(r),l=s(30893),c={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);s.d(t,c);let d={children:["",{children:["admin",{children:["billing",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8633)),"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\billing\\new\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,99111)),"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,94431)),"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,o=["D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\billing\\new\\page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/admin/billing/new/page",pathname:"/admin/billing/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},58450:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(82614).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78148:(e,t,s)=>{"use strict";s.d(t,{b:()=>l});var a=s(43210),i=s(14163),r=s(60687),n=a.forwardRef((e,t)=>(0,r.jsx)(i.sG.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var l=n},83721:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var a=s(43210);function i(e){let t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},97927:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(60687),i=s(43210),r=s(16189),n=s(85814),l=s.n(n),c=s(29523),d=s(44493),o=s(89667),u=s(80013),p=s(29867),m=s(52707),h=s(55817),x=s(49803),j=s(38485),v=s(58450),g=s(57207),f=s(35265),b=s(11516),y=s(71273),N=s(40988),S=s(3034),w=s(4780),P=s(82978);function C(){let e=(0,r.useRouter)(),{toast:t}=(0,p.dj)(),[s,n]=(0,i.useState)(!1),[C,A]=(0,i.useState)(!0),[q,k]=(0,i.useState)([]),[D,I]=(0,i.useState)(),[F,_]=(0,i.useState)(!1),[G,M]=(0,i.useState)(`INV-${new Date().getFullYear()}-${String(Date.now()).slice(-4)}`),[R,$]=(0,i.useState)(new Date().toISOString().split("T")[0]),[J,L]=(0,i.useState)(""),[T,z]=(0,i.useState)([{description:"",quantity:1,unitPrice:0,total:0}]),[B,E]=(0,i.useState)(null),[O,Z]=(0,i.useState)(""),[V,W]=(0,i.useState)(0),[H,K]=(0,i.useState)(0),[Q,U]=(0,i.useState)(0),[X,Y]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(9),[es,ea]=(0,i.useState)(9),ei=(e,t,s)=>{let a=[...T],i={...a[e]};if("description"===t)i.description=String(s);else if("quantity"===t||"unitPrice"===t){let e=Number(s)||0;"quantity"===t&&(i.quantity=e),"unitPrice"===t&&(i.unitPrice=e)}i.total=i.quantity*i.unitPrice,a[e]=i,z(a)},er=e=>{T.length>1?z(T.filter((t,s)=>s!==e)):t({title:"Cannot remove",description:"At least one item is required in the invoice.",variant:"destructive"})},en=async s=>{if(s.preventDefault(),!D||T.some(e=>!e.description||e.quantity<=0||e.unitPrice<0))return void t({title:"Missing Information",description:"Please select a patient and ensure all invoice items are filled out correctly (description, quantity > 0, price >= 0).",variant:"destructive"});n(!0);try{await (0,m.Jx)({patientId:D,appointmentId:"manual-creation",invoiceNumber:G,issueDate:R,dueDate:J||void 0,items:T,amount:V,taxAmount:H,status:"Pending",currency:"INR"}),t({title:"Invoice Created Successfully!",description:`${G} has been created.`}),e.push("/admin/billing")}catch(e){console.error("Failed to create invoice:",e),t({title:"Error Creating Invoice",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{n(!1)}},el=ee/100*V,ec=es/100*V;return(0,a.jsxs)("div",{className:"container mx-auto",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(c.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)(l(),{href:"/admin/billing",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Back to Billing List"]})})}),(0,a.jsxs)(d.Zp,{className:"max-w-4xl mx-auto shadow-xl",children:[(0,a.jsxs)(d.aR,{children:[(0,a.jsxs)(d.ZB,{className:"text-2xl font-bold flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-7 w-7 text-primary"})," Create New Invoice"]}),(0,a.jsx)(d.BT,{children:"Fill in the details to generate a new invoice."})]}),(0,a.jsxs)("form",{onSubmit:en,children:[(0,a.jsxs)(d.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(u.J,{htmlFor:"patient",children:["Patient ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(N.AM,{open:F,onOpenChange:_,children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",role:"combobox","aria-expanded":F,className:"w-full justify-between",disabled:C,children:[C?"Loading patients...":D?q.find(e=>e.id===D)?.name:"Select patient...",(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsxs)(S.uB,{children:[(0,a.jsx)(S.G7,{placeholder:"Search patient..."}),(0,a.jsxs)(S.oI,{children:[(0,a.jsx)(S.xL,{children:"No patient found."}),(0,a.jsx)(S.L$,{children:q.map(e=>(0,a.jsxs)(S.h_,{value:e.name,onSelect:()=>{I(e.id),_(!1)},children:[(0,a.jsx)(v.A,{className:(0,w.cn)("mr-2 h-4 w-4",D===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"invoiceNumber",children:"Invoice Number"}),(0,a.jsx)(o.p,{id:"invoiceNumber",value:G,onChange:e=>M(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"issueDate",children:"Issue Date"}),(0,a.jsx)(o.p,{id:"issueDate",type:"date",value:R,onChange:e=>$(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u.J,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsx)(o.p,{id:"dueDate",type:"date",value:J,onChange:e=>L(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)(u.J,{className:"text-lg font-medium",children:"Invoice Items"}),T.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsxs)(N.AM,{open:B===t,onOpenChange:e=>E(e?t:null),children:[(0,a.jsx)(N.Wv,{asChild:!0,children:(0,a.jsxs)(c.$,{variant:"outline",role:"combobox",className:"col-span-6 justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:e.description||"Select a test..."}),(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(N.hl,{className:"p-0 w-[--radix-popover-trigger-width]",children:(0,a.jsxs)(S.uB,{filter:(e,t)=>{let s=m.SA.find(t=>t.name===e);return+!!s?.name.toLowerCase().includes(t.toLowerCase())},children:[(0,a.jsx)(S.G7,{placeholder:"Search test or add custom...",value:O,onValueChange:Z}),(0,a.jsxs)(S.oI,{children:[(0,a.jsx)(S.xL,{children:O.trim()?`No test found for "${O}".`:"No test found."}),(0,a.jsx)(S.L$,{children:m.SA.map(s=>(0,a.jsxs)(S.h_,{value:s.name,onSelect:e=>{ei(t,"description",e),Z(""),E(null)},children:[(0,a.jsx)(v.A,{className:(0,w.cn)("mr-2 h-4 w-4",e.description===s.name?"opacity-100":"opacity-0")}),s.name]},s.id))})]}),O&&!m.SA.some(e=>e.name.toLowerCase()===O.toLowerCase())&&(0,a.jsx)("div",{className:"p-2 border-t mt-1",children:(0,a.jsxs)(c.$,{variant:"outline",className:"w-full h-9 text-sm",onClick:()=>{ei(t,"description",O.trim()),E(null),Z("")},children:['Add custom item: "',O.trim(),'"']})})]})})]}),(0,a.jsx)(o.p,{type:"number",placeholder:"Qty",className:"col-span-2",value:e.quantity,onChange:e=>ei(t,"quantity",e.target.value),min:"1"}),(0,a.jsx)(o.p,{type:"number",placeholder:"Unit Price (₹)",className:"col-span-2",value:e.unitPrice,onChange:e=>ei(t,"unitPrice",e.target.value),min:"0",step:"0.01"}),(0,a.jsxs)("div",{className:"col-span-1 text-right font-medium",children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(c.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>er(t),className:"col-span-1 text-destructive hover:text-destructive",children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})]},t)),(0,a.jsxs)(c.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{z([...T,{description:"",quantity:1,unitPrice:0,total:0}])},className:"mt-2",children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Add Item"]})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4 border-t",children:(0,a.jsxs)("div",{className:"w-full max-w-sm space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(u.J,{children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹",V.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.S,{id:"applyGst",checked:X,onCheckedChange:e=>Y(e)}),(0,a.jsx)("label",{htmlFor:"applyGst",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Apply GST"})]}),X&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 items-center pl-6",children:[(0,a.jsx)(u.J,{htmlFor:"cgstRate",children:"CGST Rate (%)"}),(0,a.jsx)(o.p,{id:"cgstRate",type:"number",className:"h-8",value:ee,onChange:e=>et(Number(e.target.value)||0),min:"0"}),(0,a.jsx)(u.J,{htmlFor:"sgstRate",children:"SGST Rate (%)"}),(0,a.jsx)(o.p,{id:"sgstRate",type:"number",className:"h-8",value:es,onChange:e=>ea(Number(e.target.value)||0),min:"0"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(u.J,{className:"text-muted-foreground",children:"CGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",el.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(u.J,{className:"text-muted-foreground",children:"SGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",ec.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg font-bold border-t pt-2 mt-2",children:[(0,a.jsx)(u.J,{children:"Grand Total"}),(0,a.jsxs)("span",{children:["₹",Q.toFixed(2)]})]})]})})]}),(0,a.jsx)(d.wL,{className:"pt-6",children:(0,a.jsxs)(c.$,{type:"submit",size:"lg",className:"w-full md:w-auto ml-auto",disabled:s||C,children:[s?(0,a.jsx)(b.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,a.jsx)(y.A,{className:"mr-2 h-5 w-5"}),"Save Invoice"]})})]})]})]})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9994,5814,3036,3707,3297,7859,7299,7234],()=>s(52740));module.exports=a})();