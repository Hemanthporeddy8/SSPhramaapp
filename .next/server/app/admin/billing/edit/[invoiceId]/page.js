(()=>{var e={};e.id=6100,e.ids=[6100],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6592:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\git projects\\\\SSPharmaapp\\\\SSPhramaapp\\\\src\\\\app\\\\admin\\\\billing\\\\edit\\\\[invoiceId]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\billing\\edit\\[invoiceId]\\page.tsx","default")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15079:(e,t,s)=>{"use strict";s.d(t,{bq:()=>p,eb:()=>j,gC:()=>x,l6:()=>o,yv:()=>m});var a=s(60687),i=s(43210),r=s(22670),n=s(61662),l=s(89743),d=s(58450),c=s(4780);let o=r.bL;r.YJ;let m=r.WT,p=i.forwardRef(({className:e,children:t,...s},i)=>(0,a.jsxs)(r.l9,{ref:i,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,(0,a.jsx)(r.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]}));p.displayName=r.l9.displayName;let u=i.forwardRef(({className:e,...t},s)=>(0,a.jsx)(r.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,a.jsx)(l.A,{className:"h-4 w-4"})}));u.displayName=r.PP.displayName;let h=i.forwardRef(({className:e,...t},s)=>(0,a.jsx)(r.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})}));h.displayName=r.wn.displayName;let x=i.forwardRef(({className:e,children:t,position:s="popper",...i},n)=>(0,a.jsx)(r.ZL,{children:(0,a.jsxs)(r.UC,{ref:n,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...i,children:[(0,a.jsx)(u,{}),(0,a.jsx)(r.LM,{className:(0,c.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,a.jsx)(h,{})]})}));x.displayName=r.UC.displayName,i.forwardRef(({className:e,...t},s)=>(0,a.jsx)(r.JU,{ref:s,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t})).displayName=r.JU.displayName;let j=i.forwardRef(({className:e,children:t,...s},i)=>(0,a.jsxs)(r.q7,{ref:i,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(r.p4,{children:t})]}));j.displayName=r.q7.displayName,i.forwardRef(({className:e,...t},s)=>(0,a.jsx)(r.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=r.wv.displayName},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},28215:(e,t,s)=>{Promise.resolve().then(s.bind(s,6592))},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65838:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>o,routeModule:()=>p,tree:()=>c});var a=s(65239),i=s(48088),r=s(88170),n=s.n(r),l=s(30893),d={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let c={children:["",{children:["admin",{children:["billing",{children:["edit",{children:["[invoiceId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6592)),"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\billing\\edit\\[invoiceId]\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,99111)),"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,94431)),"D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,o=["D:\\git projects\\SSPharmaapp\\SSPhramaapp\\src\\app\\admin\\billing\\edit\\[invoiceId]\\page.tsx"],m={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/admin/billing/edit/[invoiceId]/page",pathname:"/admin/billing/edit/[invoiceId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},81359:(e,t,s)=>{Promise.resolve().then(s.bind(s,86764))},86764:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var a=s(60687),i=s(43210),r=s(16189),n=s(85814),l=s.n(n),d=s(29523),c=s(44493),o=s(89667),m=s(80013),p=s(29867),u=s(52707),h=s(11516),x=s(55817);let j=(0,s(82614).A)("FilePen",[["path",{d:"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5",key:"1couwa"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1y4qbx"}]]);var f=s(38485),v=s(58450),g=s(57207),y=s(35265),N=s(71273),b=s(40988),S=s(3034),w=s(4780),P=s(82978),C=s(15079);function A(){let e=(0,r.useRouter)(),t=(0,r.useParams)().invoiceId,{toast:s}=(0,p.dj)(),[n,A]=(0,i.useState)(null),[q,I]=(0,i.useState)(!0),[k,F]=(0,i.useState)(!1),[R,_]=(0,i.useState)([]),[D,J]=(0,i.useState)(),[G,L]=(0,i.useState)(!1),[$,M]=(0,i.useState)(""),[z,T]=(0,i.useState)(""),[B,E]=(0,i.useState)(""),[U,V]=(0,i.useState)([]),[W,O]=(0,i.useState)("Pending"),[Z,H]=(0,i.useState)(null),[K,Q]=(0,i.useState)(""),[X,Y]=(0,i.useState)(0),[ee,et]=(0,i.useState)(0),[es,ea]=(0,i.useState)(0),[ei,er]=(0,i.useState)(!1),[en,el]=(0,i.useState)(9),[ed,ec]=(0,i.useState)(9),eo=(e,t,s)=>{let a=[...U],i={...a[e]};if("description"===t)i.description=String(s);else if("quantity"===t||"unitPrice"===t){let e=Number(s)||0;"quantity"===t&&(i.quantity=e),"unitPrice"===t&&(i.unitPrice=e)}i.total=i.quantity*i.unitPrice,a[e]=i,V(a)},em=e=>{U.length>1?V(U.filter((t,s)=>s!==e)):s({title:"Cannot remove",description:"At least one item is required.",variant:"destructive"})},ep=async a=>{if(a.preventDefault(),!D||U.some(e=>!e.description||e.quantity<=0||e.unitPrice<0))return void s({title:"Missing Information",description:"Please select a patient and ensure all items are filled out.",variant:"destructive"});F(!0);try{await (0,u.Dq)(t,{patientId:D,invoiceNumber:$,issueDate:z,dueDate:B||void 0,items:U,amount:X,taxAmount:ee,status:W,currency:"INR"}),s({title:"Invoice Updated Successfully!",description:`${$} has been updated.`}),e.push("/admin/billing")}catch(e){console.error("Failed to update invoice:",e),s({title:"Error Updating Invoice",description:"An unexpected error occurred.",variant:"destructive"})}finally{F(!1)}},eu=en/100*X,eh=ed/100*X;return q?(0,a.jsxs)("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:[(0,a.jsx)(h.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading invoice editor..."})]}):n?(0,a.jsxs)("div",{className:"container mx-auto",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(d.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)(l(),{href:"/admin/billing",children:[(0,a.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Back to Billing List"]})})}),(0,a.jsxs)(c.Zp,{className:"max-w-4xl mx-auto shadow-xl",children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsxs)(c.ZB,{className:"text-2xl font-bold flex items-center gap-2",children:[(0,a.jsx)(j,{className:"h-7 w-7 text-primary"})," Edit Invoice"]}),(0,a.jsxs)(c.BT,{children:["Modify details for invoice: ",n.invoiceNumber]})]}),(0,a.jsxs)("form",{onSubmit:ep,children:[(0,a.jsxs)(c.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(m.J,{htmlFor:"patient",children:["Patient ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsxs)(b.AM,{open:G,onOpenChange:L,children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",role:"combobox","aria-expanded":G,className:"w-full justify-between",children:[D?R.find(e=>e.id===D)?.name:"Select patient...",(0,a.jsx)(f.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(b.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsxs)(S.uB,{children:[(0,a.jsx)(S.G7,{placeholder:"Search patient..."}),(0,a.jsxs)(S.oI,{children:[(0,a.jsx)(S.xL,{children:"No patient found."}),(0,a.jsx)(S.L$,{children:R.map(e=>(0,a.jsxs)(S.h_,{value:e.name,onSelect:()=>{J(e.id),L(!1)},children:[(0,a.jsx)(v.A,{className:(0,w.cn)("mr-2 h-4 w-4",D===e.id?"opacity-100":"opacity-0")}),e.name]},e.id))})]})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"invoiceNumber",children:"Invoice Number"}),(0,a.jsx)(o.p,{id:"invoiceNumber",value:$,onChange:e=>M(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"issueDate",children:"Issue Date"}),(0,a.jsx)(o.p,{id:"issueDate",type:"date",value:z,onChange:e=>T(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"dueDate",children:"Due Date"}),(0,a.jsx)(o.p,{id:"dueDate",type:"date",value:B,onChange:e=>E(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)(m.J,{className:"text-lg font-medium",children:"Invoice Items"}),U.map((e,t)=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsxs)(b.AM,{open:Z===t,onOpenChange:e=>H(e?t:null),children:[(0,a.jsx)(b.Wv,{asChild:!0,children:(0,a.jsxs)(d.$,{variant:"outline",role:"combobox",className:"col-span-6 justify-between",children:[(0,a.jsx)("span",{className:"truncate",children:e.description||"Select a test..."}),(0,a.jsx)(f.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(b.hl,{className:"p-0 w-[--radix-popover-trigger-width]",children:(0,a.jsxs)(S.uB,{filter:(e,t)=>{let s=u.SA.find(t=>t.name===e);return+!!s?.name.toLowerCase().includes(t.toLowerCase())},children:[(0,a.jsx)(S.G7,{placeholder:"Search test or add custom...",value:K,onValueChange:Q}),(0,a.jsxs)(S.oI,{children:[(0,a.jsx)(S.xL,{children:K.trim()?`No test found for "${K}".`:"No test found."}),(0,a.jsx)(S.L$,{children:u.SA.map(s=>(0,a.jsxs)(S.h_,{value:s.name,onSelect:e=>{eo(t,"description",e),Q(""),H(null)},children:[(0,a.jsx)(v.A,{className:(0,w.cn)("mr-2 h-4 w-4",e.description===s.name?"opacity-100":"opacity-0")}),s.name]},s.id))})]}),K&&!u.SA.some(e=>e.name.toLowerCase()===K.toLowerCase())&&(0,a.jsx)("div",{className:"p-2 border-t mt-1",children:(0,a.jsxs)(d.$,{variant:"outline",className:"w-full h-9 text-sm",onClick:()=>{eo(t,"description",K.trim()),H(null),Q("")},children:['Add custom item: "',K.trim(),'"']})})]})})]}),(0,a.jsx)(o.p,{type:"number",placeholder:"Qty",className:"col-span-2",value:e.quantity,onChange:e=>eo(t,"quantity",e.target.value),min:"1"}),(0,a.jsx)(o.p,{type:"number",placeholder:"Unit Price (₹)",className:"col-span-2",value:e.unitPrice,onChange:e=>eo(t,"unitPrice",e.target.value),min:"0",step:"0.01"}),(0,a.jsxs)("div",{className:"col-span-1 text-right font-medium",children:["₹",e.total.toFixed(2)]}),(0,a.jsx)(d.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>em(t),className:"col-span-1 text-destructive hover:text-destructive",children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})]},t)),(0,a.jsxs)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{V([...U,{description:"",quantity:1,unitPrice:0,total:0}])},className:"mt-2",children:[(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Add Item"]})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 pt-4 border-t",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(m.J,{className:"text-lg font-medium",children:"Billing Summary"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(m.J,{children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-semibold",children:["₹",X.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(P.S,{id:"applyGst",checked:ei,onCheckedChange:e=>er(e)}),(0,a.jsx)("label",{htmlFor:"applyGst",className:"text-sm font-medium",children:"Apply GST"})]}),ei&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 items-center pl-6",children:[(0,a.jsx)(m.J,{htmlFor:"cgstRate",children:"CGST Rate (%)"}),(0,a.jsx)(o.p,{id:"cgstRate",type:"number",className:"h-8",value:en,onChange:e=>el(Number(e.target.value)||0)}),(0,a.jsx)(m.J,{htmlFor:"sgstRate",children:"SGST Rate (%)"}),(0,a.jsx)(o.p,{id:"sgstRate",type:"number",className:"h-8",value:ed,onChange:e=>ec(Number(e.target.value)||0)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(m.J,{className:"text-muted-foreground",children:"CGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",eu.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pl-6",children:[(0,a.jsx)(m.J,{className:"text-muted-foreground",children:"SGST"}),(0,a.jsxs)("span",{className:"text-muted-foreground",children:["₹",eh.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg font-bold border-t pt-2 mt-2",children:[(0,a.jsx)(m.J,{children:"Grand Total"}),(0,a.jsxs)("span",{children:["₹",es.toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.J,{htmlFor:"status",className:"text-lg font-medium",children:"Payment Status"}),(0,a.jsxs)(C.l6,{value:W,onValueChange:e=>O(e),children:[(0,a.jsx)(C.bq,{id:"status",children:(0,a.jsx)(C.yv,{placeholder:"Select payment status"})}),(0,a.jsxs)(C.gC,{children:[(0,a.jsx)(C.eb,{value:"Pending",children:"Pending"}),(0,a.jsx)(C.eb,{value:"Paid",children:"Paid"}),(0,a.jsx)(C.eb,{value:"Failed",children:"Failed"})]})]})]})]})]}),(0,a.jsxs)(c.wL,{className:"pt-6 flex justify-between",children:[(0,a.jsx)(d.$,{type:"button",variant:"outline",onClick:()=>e.push("/admin/billing"),disabled:k,children:"Cancel"}),(0,a.jsxs)(d.$,{type:"submit",size:"lg",className:"w-full md:w-auto",disabled:k,children:[k?(0,a.jsx)(h.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,a.jsx)(N.A,{className:"mr-2 h-5 w-5"}),"Save Changes"]})]})]})]})]}):null}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[9994,5814,3036,6525,3707,3297,7859,7299,7234],()=>s(65838));module.exports=a})();